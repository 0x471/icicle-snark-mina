# icicle-snark-o1js

A PoC for converting Groth16 proofs generated by [icicle-snark](https://github.com/ingonyama-zk/icicle-snark) to the format required by [o1js-blobstream](https://github.com/geometers/o1js-blobstream) for proof verification in o1js.

## Overview

This repository provides a complete pipeline for:
1. Generating hardware-accelerated proofs using icicle-snark
2. Converting proof formats from icicle-snark (snarkjs) to o1js-blobstream
3. Verifying proofs in a zkApp environment

The main component is a Rust-based format converter that transforms Groth16 proofs between different representations while maintaining cryptographic correctness.

## Architecture

```
icicle-snark    →    Format Converter    →    o1js-blobstream    →    zkApp Verification
       ↓                      ↓                        ↓                        ↓
   Generate              Convert to              Build & Run              Verify Proof
   SNARK Proof      o1js-blobstream Format      Contracts              in zkApp
```

## Repository Structure

```
.
├── src/
│   └── main.rs                  # main proof format conversion logic
├── icicle-snark/
│   ├── benchmark/poly_eval/     # poly-evaluation example/benchmark 
│   └── examples/rust/           # rust example for proof generation
├── o1js-blobstream/
│   ├── contracts/               # verification scripts
│   └── scripts/                 # pipeline scripts
├── run_poly_eval_pipeline.sh    # main pipeline script
├── clean.sh                     # cleanup script
└── Cargo.toml
```

## Quick Start

### Prerequisites

- **Rust toolchain** (latest stable)
- **Node.js** (v18+) and **npm**
- **Circom** (circuit compiler)
- **snarkjs** (SNARK toolkit)
- **Python 3** (for constraint calculations)
- **wget** (for downloading ptau files)

### Setup

1. **Clone the repository:**
   ```bash
   git clone https://github.com/o1-labs/icicle-snark-mina-15-07.git
   cd icicle-snark-mina-15-07
   ```
That's all :)

## Usage

### Complete Pipeline

The easiest way to run the entire pipeline:

```bash
# Clean everything first, then run pipeline
./run_poly_eval_pipeline.sh --cleanup

# Run pipeline without cleanup
./run_poly_eval_pipeline.sh

# Show help
./run_poly_eval_pipeline.sh --help
```

### Cleanup

To clean up all generated files:

```bash
./clean.sh
```

## Proof Format Converter

### Proof Formats

#### Input Format (snarkjs)
```json
{
  "pi_a": ["x", "y"],
  "pi_b": [["x_c0", "x_c1"], ["y_c0", "y_c1"]],
  "pi_c": ["x", "y"]
}
```

#### Output Format (o1js-blobstream)
```json
{
  "negA": {"x": "...", "y": "..."},
  "B": {"x_c0": "...", "x_c1": "...", "y_c0": "...", "y_c1": "..."},
  "C": {"x": "...", "y": "..."},
  "pi1": "...",
  "pi2": "...",
  "pi3": "...",
  "pi4": "...",
  "pi5": "..."
}
```

### Verification Key Formats

#### Input Format (snarkjs)
```json
{
  "protocol": "groth16",
  "curve": "bn128",
  "nPublic": 1,
  "vk_alpha_1": ["x", "y"],
  "vk_beta_2": [["x_c0", "x_c1"], ["y_c0", "y_c1"]],
  "vk_gamma_2": [["x_c0", "x_c1"], ["y_c0", "y_c1"]],
  "vk_delta_2": [["x_c0", "x_c1"], ["y_c0", "y_c1"]],
  "IC": [["x", "y"], ["x", "y"]]
}
```

#### Output Format (o1js-blobstream)
```json
{
  "alpha": {"x": "...", "y": "..."},
  "beta": {"x_c0": "...", "x_c1": "...", "y_c0": "...", "y_c1": "..."},
  "gamma": {"x_c0": "...", "x_c1": "...", "y_c0": "...", "y_c1": "..."},
  "delta": {"x_c0": "...", "x_c1": "...", "y_c0": "...", "y_c1": "..."},
  "alpha_beta": {
    "g00": "...", "g01": "...", "g10": "...", "g11": "...",
    "g20": "...", "g21": "...", "h00": "...", "h01": "...",
    "h10": "...", "h11": "...", "h20": "...", "h21": "..."
  },
  "w27": {
    "g00": "...", "g01": "...", "g10": "...", "g11": "...",
    "g20": "...", "g21": "...", "h00": "...", "h01": "...",
    "h10": "...", "h11": "...", "h20": "...", "h21": "..."
  },
  "ic0": {"x": "...", "y": "..."},
  "ic1": {"x": "...", "y": "..."},
  "ic2": {"x": "...", "y": "..."},
  "ic3": {"x": "...", "y": "..."},
  "ic4": {"x": "...", "y": "..."},
  "ic5": {"x": "...", "y": "..."}
}
```

### Usage
```bash
cargo run -- <proof.json> <public.json> <vk.json> <output_proof.json> <output_vk.json>
```
